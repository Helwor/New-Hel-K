-- by Helwor license: GNU GPL, v2 or later
-- give the y offset of the base position, from which a unit would aim with given weapon
-- this is for a better range simulation calculation on non existing unit
if WG.aim_from_poses then
    return WG.aim_from_poses
end
WG.aim_from_poses = {
	amphaa = 27.3841801,
	amphassault = 48.4933319,
	amphfloater = 35.8144226,
	amphimpulse = 24.2909985,
	amphlaunch = 8.11442471,
	amphraid = 25.9248428,
	amphriot = 30.2720184,
	amphsupport = 32.3666649,
	armcom0 = 36.0749969,
	armcom1 = 36.0749969,
	armcom2 = 39.6824951,
	armcom3 = 43.2899933,
	armcom4 = 45.0937347,
	armcom5 = 46.8974915,
	benzcom0 = 32.70681,
	benzcom1 = 32.70681,
	benzcom2 = 36.0820427,
	benzcom3 = 38.8984871,
	benzcom4 = 40.6438713,
	benzcom5 = 42.1585464,
	bomberassault = -18.432348,
	bomberdisarm = -10,
	bomberheavy = 2.15093207,
	bomberprec = -2,
	bomberstrike = 4,
	chicken = 23.7708321,
	chicken_blimpy = -12,
	chicken_digger = -6.2450962,
	chicken_leaper = 55.4560013,
	chicken_pigeon = 6.80000019,
	chicken_rafflesia = 0,
	chicken_shield = 30.0189724,
	chicken_spidermonkey = 33.5007782,
	chicken_sporeshooter = 33.5007782,
	chickenblobber = 34.3534851,
	chickenc = 43.7799568,
	chickend = 21.6666508,
	chickenf = 7.5999999,
	chickenr = 27.9932537,
	chickens = 27.2939129,
	chickenspire = 86.9269104,
	chickenwurm = 9.55936527,
	cloakaa = 30.825592,
	cloakarty = 33.0588989,
	cloakassault = 29.8148041,
	cloakheavyraid = 34.1119003,
	cloakraid = 26.2401123,
	cloakriot = 18.6453667,
	cloakskirm = 29.2013588,
	cloaksnipe = 54.6286507,
	comm_battle_pea = 37.5537987,
	comm_cai_assault_0 = 36.0749969,
	comm_cai_assault_1 = 36.0749969,
	comm_cai_assault_2 = 39.6824951,
	comm_cai_assault_3 = 43.2899933,
	comm_cai_assault_4 = 45.0937347,
	comm_cai_assault_5 = 46.8974915,
	comm_cai_hispeed_0 = 45.0871506,
	comm_cai_hispeed_1 = 45.0871506,
	comm_cai_hispeed_2 = 49.5959167,
	comm_cai_hispeed_3 = 55.106575,
	comm_cai_hispeed_4 = 57.3108368,
	comm_cai_hispeed_5 = 59.5151062,
	comm_cai_range_0 = 32.70681,
	comm_cai_range_1 = 32.70681,
	comm_cai_range_2 = 36.0820427,
	comm_cai_range_3 = 38.8984871,
	comm_cai_range_4 = 40.6438713,
	comm_cai_range_5 = 42.1585464,
	comm_cai_riot_0 = 37.5537987,
	comm_cai_riot_1 = 37.5537987,
	comm_cai_riot_2 = 41.3091774,
	comm_cai_riot_3 = 45.0645599,
	comm_cai_riot_4 = 46.9422493,
	comm_cai_riot_5 = 48.8199348,
	comm_cai_specialist_0 = 45.6299973,
	comm_cai_specialist_1 = 45.6299973,
	comm_cai_specialist_2 = 50.1930008,
	comm_cai_specialist_3 = 54.7560043,
	comm_cai_specialist_4 = 57.0374985,
	comm_cai_specialist_5 = 59.3189964,
	comm_campaign_ada = 32.670002,
	comm_campaign_biovizier = 50.1930008,
	comm_campaign_odin = 49.5959167,
	comm_campaign_praetorian = 36.0820427,
	comm_campaign_promethean = 49.5959167,
	comm_econ_cai = 45.6299973,
	comm_flamer = 41.3091774,
	comm_guardian = 39.6824951,
	comm_hammer = 36.0820427,
	comm_hunter = 50.1930008,
	comm_marine = 49.5959167,
	comm_marksman = 50.1930008,
	comm_marksman_cai = 45.6299973,
	comm_mission_tutorial1 = 35.6400032,
	comm_recon = 49.5959167,
	comm_recon_pea = 45.0871506,
	comm_riot = 41.3091774,
	comm_riot_cai = 37.5537987,
	comm_rocketeer = 36.0820427,
	comm_strike_hmg = 36.0749969,
	comm_strike_lpb = 36.0749969,
	comm_strike_pea = 36.0749969,
	comm_stun_cai = 36.0749969,
	comm_support_pea = 45.6299973,
	comm_thunder = 39.6824951,
	comm_trainer_battle_0 = 37.5537987,
	comm_trainer_battle_1 = 37.5537987,
	comm_trainer_battle_2 = 41.3091774,
	comm_trainer_battle_3 = 45.0645599,
	comm_trainer_battle_4 = 46.9422493,
	comm_trainer_battle_5 = 48.8199348,
	comm_trainer_recon_0 = 45.0871506,
	comm_trainer_recon_1 = 45.0871506,
	comm_trainer_recon_2 = 49.5959167,
	comm_trainer_recon_3 = 55.106575,
	comm_trainer_recon_4 = 57.3108368,
	comm_trainer_recon_5 = 59.5151062,
	comm_trainer_siege_0 = 32.70681,
	comm_trainer_siege_1 = 32.70681,
	comm_trainer_siege_2 = 36.0820427,
	comm_trainer_siege_3 = 38.8984871,
	comm_trainer_siege_4 = 40.6438713,
	comm_trainer_siege_5 = 42.1585464,
	comm_trainer_strike_0 = 36.0749969,
	comm_trainer_strike_1 = 36.0749969,
	comm_trainer_strike_2 = 39.6824951,
	comm_trainer_strike_3 = 43.2899933,
	comm_trainer_strike_4 = 45.0937347,
	comm_trainer_strike_5 = 46.8974915,
	comm_trainer_support_0 = 45.6299973,
	comm_trainer_support_1 = 45.6299973,
	comm_trainer_support_2 = 50.1930008,
	comm_trainer_support_3 = 54.7560043,
	comm_trainer_support_4 = 57.0374985,
	comm_trainer_support_5 = 59.3189964,
	commrecon0 = 45.0871506,
	commrecon1 = 45.0871506,
	commrecon2 = 49.5959167,
	commrecon3 = 55.106575,
	commrecon4 = 57.3108368,
	commrecon5 = 59.5151062,
	commsupport0 = 45.6299973,
	commsupport1 = 45.6299973,
	commsupport2 = 50.1930008,
	commsupport3 = 54.7560043,
	commsupport4 = 57.0374985,
	commsupport5 = 59.3189964,
	corcom0 = 37.5537987,
	corcom1 = 37.5537987,
	corcom2 = 41.3091774,
	corcom3 = 45.0645599,
	corcom4 = 46.9422493,
	corcom5 = 48.8199348,
	cremcom0 = 29.7000008,
	cremcom1 = 29.7000008,
	cremcom2 = 32.670002,
	cremcom3 = 35.6400032,
	cremcom4 = 37.125,
	cremcom5 = 38.6100006,
	dronecarry = 1.42000008,
	dronefighter = 0.2824291,
	droneheavyslow = 0,
	dronelight = 2.25,
	dynassault0 = 25.1499996,
	dynassault1 = 25.1499996,
	dynassault1_00 = 25.1499996,
	dynassault2 = 27.7999992,
	dynassault2_00 = 27.7999992,
	dynassault2_10 = 27.7999992,
	dynassault3 = 30,
	dynassault3_00 = 30,
	dynassault3_01 = 30,
	dynassault3_10 = 30,
	dynassault3_11 = 30,
	dynassault4 = 31.2999992,
	dynassault4_00 = 31.2999992,
	dynassault4_01 = 31.2999992,
	dynassault4_10 = 31.2999992,
	dynassault4_11 = 31.2999992,
	dynassault5 = 32.5,
	dynassault5_00 = 32.5,
	dynassault5_01 = 32.5,
	dynassault5_10 = 32.5,
	dynassault5_11 = 32.5,
	dynfancy_guardian_base = 25.1499996,
	dynfancy_recon2_base = 49.34478,
	dynfancy_recon_base = 49.34478,
	dynfancy_strike_base = 35.8459167,
	dynfancy_strike_lobster_base = 35.8459167,
	dynfancy_support2_base = 51.4799957,
	dynfancy_support3_base = 51.4799957,
	dynfancy_support4_base = 51.4799957,
	dynfancy_support_base = 51.4799957,
	dynhub_assault_base = 25.1499996,
	dynhub_recon_base = 49.34478,
	dynhub_strike_base = 35.8459167,
	dynhub_support_base = 51.4799957,
	dynknight0 = 29.7000008,
	dynknight1 = 29.7000008,
	dynknight1_0000 = 29.7000008,
	dynknight1_0001 = 29.7000008,
	dynknight1_0010 = 29.7000008,
	dynknight1_0011 = 29.7000008,
	dynknight1_0100 = 29.7000008,
	dynknight1_0101 = 29.7000008,
	dynknight1_0110 = 29.7000008,
	dynknight1_0111 = 29.7000008,
	dynknight1_1000 = 29.7000008,
	dynknight1_1001 = 29.7000008,
	dynknight1_1010 = 29.7000008,
	dynknight1_1011 = 29.7000008,
	dynknight1_1100 = 29.7000008,
	dynknight1_1101 = 29.7000008,
	dynknight1_1110 = 29.7000008,
	dynknight1_1111 = 29.7000008,
	dynknight2 = 32.670002,
	dynknight2_0000 = 32.670002,
	dynknight2_0001 = 32.670002,
	dynknight2_0010 = 32.670002,
	dynknight2_0011 = 32.670002,
	dynknight2_0100 = 32.670002,
	dynknight2_0101 = 32.670002,
	dynknight2_0110 = 32.670002,
	dynknight2_0111 = 32.670002,
	dynknight2_1000 = 32.670002,
	dynknight2_1001 = 32.670002,
	dynknight2_1010 = 32.670002,
	dynknight2_1011 = 32.670002,
	dynknight2_1100 = 32.670002,
	dynknight2_1101 = 32.670002,
	dynknight2_1110 = 32.670002,
	dynknight2_1111 = 32.670002,
	dynknight3 = 35.6400032,
	dynknight3_0000 = 35.6400032,
	dynknight3_0001 = 35.6400032,
	dynknight3_0010 = 35.6400032,
	dynknight3_0011 = 35.6400032,
	dynknight3_0100 = 35.6400032,
	dynknight3_0101 = 35.6400032,
	dynknight3_0110 = 35.6400032,
	dynknight3_0111 = 35.6400032,
	dynknight3_1000 = 35.6400032,
	dynknight3_1001 = 35.6400032,
	dynknight3_1010 = 35.6400032,
	dynknight3_1011 = 35.6400032,
	dynknight3_1100 = 35.6400032,
	dynknight3_1101 = 35.6400032,
	dynknight3_1110 = 35.6400032,
	dynknight3_1111 = 35.6400032,
	dynknight4 = 37.125,
	dynknight4_0000 = 37.125,
	dynknight4_0001 = 37.125,
	dynknight4_0010 = 37.125,
	dynknight4_0011 = 37.125,
	dynknight4_0100 = 37.125,
	dynknight4_0101 = 37.125,
	dynknight4_0110 = 37.125,
	dynknight4_0111 = 37.125,
	dynknight4_1000 = 37.125,
	dynknight4_1001 = 37.125,
	dynknight4_1010 = 37.125,
	dynknight4_1011 = 37.125,
	dynknight4_1100 = 37.125,
	dynknight4_1101 = 37.125,
	dynknight4_1110 = 37.125,
	dynknight4_1111 = 37.125,
	dynknight5 = 38.6100006,
	dynknight5_0000 = 38.6100006,
	dynknight5_0001 = 38.6100006,
	dynknight5_0010 = 38.6100006,
	dynknight5_0011 = 38.6100006,
	dynknight5_0100 = 38.6100006,
	dynknight5_0101 = 38.6100006,
	dynknight5_0110 = 38.6100006,
	dynknight5_0111 = 38.6100006,
	dynknight5_1000 = 38.6100006,
	dynknight5_1001 = 38.6100006,
	dynknight5_1010 = 38.6100006,
	dynknight5_1011 = 38.6100006,
	dynknight5_1100 = 38.6100006,
	dynknight5_1101 = 38.6100006,
	dynknight5_1110 = 38.6100006,
	dynknight5_1111 = 38.6100006,
	dynrecon0 = 49.34478,
	dynrecon1 = 49.34478,
	dynrecon1_0 = 49.34478,
	dynrecon2 = 54.2793121,
	dynrecon2_0 = 54.2793121,
	dynrecon2_1 = 54.2793121,
	dynrecon3 = 60.3103485,
	dynrecon3_0 = 60.3103485,
	dynrecon3_1 = 60.3103485,
	dynrecon4 = 62.7227631,
	dynrecon4_0 = 62.7227631,
	dynrecon4_1 = 62.7227631,
	dynrecon5 = 65.1351852,
	dynrecon5_0 = 65.1351852,
	dynrecon5_1 = 65.1351852,
	dynstrike0 = 35.8459167,
	dynstrike1 = 35.8459167,
	dynstrike1_00 = 35.8459167,
	dynstrike2 = 38.330513,
	dynstrike2_00 = 38.330513,
	dynstrike2_10 = 38.330513,
	dynstrike3 = 41.8151016,
	dynstrike3_00 = 41.8151016,
	dynstrike3_01 = 41.8151016,
	dynstrike3_10 = 41.8151016,
	dynstrike3_11 = 41.8151016,
	dynstrike4 = 43.5573997,
	dynstrike4_00 = 43.5573997,
	dynstrike4_01 = 43.5573997,
	dynstrike4_10 = 43.5573997,
	dynstrike4_11 = 43.5573997,
	dynstrike5 = 45.2996941,
	dynstrike5_00 = 45.2996941,
	dynstrike5_01 = 45.2996941,
	dynstrike5_10 = 45.2996941,
	dynstrike5_11 = 45.2996941,
	dynsupport0 = 51.4799957,
	dynsupport1 = 51.4799957,
	dynsupport1_000 = 51.4799957,
	dynsupport2 = 56.6928635,
	dynsupport2_000 = 56.6928635,
	dynsupport2_001 = 56.6928635,
	dynsupport2_100 = 56.6928635,
	dynsupport2_101 = 56.6928635,
	dynsupport3 = 61.776001,
	dynsupport3_000 = 61.776001,
	dynsupport3_001 = 61.776001,
	dynsupport3_010 = 61.776001,
	dynsupport3_011 = 61.776001,
	dynsupport3_100 = 61.776001,
	dynsupport3_101 = 61.776001,
	dynsupport3_110 = 61.776001,
	dynsupport3_111 = 61.776001,
	dynsupport4 = 64.3499985,
	dynsupport4_000 = 64.3499985,
	dynsupport4_001 = 64.3499985,
	dynsupport4_010 = 64.3499985,
	dynsupport4_011 = 64.3499985,
	dynsupport4_100 = 64.3499985,
	dynsupport4_101 = 64.3499985,
	dynsupport4_110 = 64.3499985,
	dynsupport4_111 = 64.3499985,
	dynsupport5 = 66.923996,
	dynsupport5_000 = 66.923996,
	dynsupport5_001 = 66.923996,
	dynsupport5_010 = 66.923996,
	dynsupport5_011 = 66.923996,
	dynsupport5_100 = 66.923996,
	dynsupport5_101 = 66.923996,
	dynsupport5_110 = 66.923996,
	dynsupport5_111 = 66.923996,
	dyntrainer_assault_base = 25.1499996,
	dyntrainer_recon_base = 49.34478,
	dyntrainer_strike_base = 35.8459167,
	dyntrainer_support_base = 51.4799957,
	empmissile = 40,
	grebe = 28.7000008,
	gunshipaa = 22,
	gunshipassault = 10,
	gunshipemp = 5.49067593,
	gunshipheavyskirm = 8,
	gunshipraid = 2.48465896,
	gunshipskirm = 4,
	hoveraa = 33.9007874,
	hoverarty = 46.5857277,
	hoverassault = 13.8918476,
	hoverdepthcharge = 9.30751228,
	hoverheavyraid = 20.1333427,
	hoverminer = 33.4700241,
	hoverraid = 14.2999992,
	hoverriot = 18.9024601,
	hovershotgun = 20.1548309,
	hoverskirm = 20.7485542,
	hoversonic = 20.1148319,
	jumpaa = 36.8900032,
	jumparty = 32.0672379,
	jumpassault = 34.1910934,
	jumpblackhole = 37.6048775,
	jumpcon = 17.1240425,
	jumpraid = 22.0874386,
	jumpscout = 13.4954567,
	jumpskirm = 28.1380253,
	mahlazer = 46.1096077,
	missileslow = 39.9999962,
	napalmmissile = 40,
	planefighter = 0,
	planeheavyfighter = 10,
	pw_garrison = 55.9999924,
	pw_grid = 89.9999924,
	pw_hq_attacker = 52.5,
	pw_hq_defender = 52.5,
	raveparty = 112.5,
	roost = 4,
	seismic = 40,
	shieldaa = 30.75,
	shieldarty = 20.7073002,
	shieldassault = 19.5293293,
	shieldfelon = 45.4000015,
	shieldraid = 20.0768414,
	shieldriot = 22.6460438,
	shieldskirm = 30.5,
	shiparty = 10.0800009,
	shipcarrier = 94.6571274,
	shipscout = 6.61059856,
	shipskirm = 13.7080002,
	shiptorpraider = 11.3623199,
	spideraa = 13.2000008,
	spideranarchid = 150,
	spiderantiheavy = 12.5,
	spiderassault = 15.7254,
	spidercrabe = 23.5703945,
	spideremp = 17.1000004,
	spiderriot = 33.5,
	spiderscout = 13.4064741,
	spiderskirm = 19.9300003,
	starlight_satellite = -7.2610583,
	staticantinuke = 80,
	staticarty = 0,
	staticheavyarty = 112.800003,
	striderantiheavy = 35.9099884,
	striderarty = 40.5099945,
	striderdante = 36,
	striderdozer = 0,
	subraider = 10,
	subtacmissile = 25.0999908,
	tacnuke = 40,
	tankaa = 35.1240005,
	tankarty = 18.3500023,
	tankassault = 20.4000015,
	tankcon = 17.6044044,
	tankheavyarty = 17,
	tankheavyraid = 9.80000019,
	tankraid = 13.8000002,
	tankriot = 22.5,
	tiptest = 18,
	turretaaclose = 22.75,
	turretaafar = 32.545517,
	turretaaflak = 66.0999985,
	turretaaheavy = 24,
	turretaalaser = 24,
	turretantiheavy = 86.2067184,
	turretemp = 60,
	turretgauss = 44.8350677,
	turretheavylaser = 96.7776794,
	turretimpulse = 32.7333221,
	turretlaser = 65.5999985,
	turretmissile = 40.6726723,
	turretriot = 21.2137489,
	turretsunlance = 16.8000011,
	turrettorp = 9.53783035,
	vehaa = 27.46912,
	veharty = 15.3999996,
	vehassault = 18,
	vehcapture = 18.0199986,
	vehraid = 14.1000004,
	vehriot = 18.7000008,
	vehscout = 18.4734726,
	vehsupport = 25.6000004,
	wolverine_mine = 4.02338457,
	zenith = 120,
	assaultcruiser = {
		[1] = 0,
		[2] = 12.000001,
		[3] = 12.000001,
		[4] = 12.000001,
		[5] = 12.000001,
		[6] = 13.2000008,
		[7] = 13.2000008,
	},
	chicken_dragon = {
		[1] = 57.7797928,
		[2] = 98.2086182,
		[3] = 111.315338,
		[4] = 115.287102,
		[5] = 57.7797928,
		[6] = 49.7999878,
	},
	chicken_roc = {
		[1] = 23.303194,
		[2] = 36.7378387,
		[3] = 40.3060112,
	},
	chicken_tiamat = {
		[1] = 34.3098869,
		[2] = 64.9016266,
		[3] = 34.3098869,
		[4] = 29.75,
	},
	chickena = {
		[1] = 36.3401108,
		[2] = 33.75,
	},
	chickenbroodqueen = {
		[1] = 34.0282364,
		[2] = 57.4120789,
		[3] = 64.9016266,
		[4] = 67.1712036,
		[5] = 34.0282364,
	},
	chickenflyerqueen = {
		[1] = 76.6773071,
		[2] = 121.459465,
		[3] = 133.353363,
		[4] = 136.227097,
		[5] = 72.3333054,
		[6] = 72.3333054,
		[7] = 72.3333054,
	},
	chickenlandqueen = {
		[1] = 76.6607742,
		[2] = 76.6607742,
		[3] = 121.287193,
		[4] = 133.135834,
		[5] = 135.998642,
		[6] = 72.3333054,
		[7] = 72.3333054,
		[8] = 72.3333054,
		[9] = 72.3333054,
	},
	comm_campaign_freemachine = {
		[1] = 38.330513,
		[5] = 29.2690639,
	},
	comm_campaign_isonade = {
		[1] = 38.330513,
		[5] = 29.2690639,
	},
	comm_campaign_legion = {
		[1] = 38.330513,
		[5] = 29.2690639,
	},
	commstrike0 = {
		[1] = 35.8459167,
		[5] = 27.6082382,
	},
	commstrike1 = {
		[1] = 35.8459167,
		[5] = 27.6082382,
	},
	commstrike2 = {
		[1] = 38.330513,
		[5] = 29.2690639,
	},
	commstrike3 = {
		[1] = 41.8151016,
		[5] = 31.9298897,
	},
	commstrike4 = {
		[1] = 43.5573997,
		[5] = 33.2602959,
	},
	commstrike5 = {
		[1] = 45.2996941,
		[5] = 34.5907059,
	},
	gunshipheavytrans = {
		[1] = 14.2650309,
		[2] = 14.1486988,
		[3] = 17.238451,
	},
	gunshipkrow = {
		[1] = 18.5052643,
		[2] = 18.2587662,
		[3] = 17.5,
		[4] = 18.5052643,
	},
	jumpsumo = {
		[1] = 55.1000099,
		[2] = 60.5000114,
		[3] = 60.5000114,
		[4] = 60.5000114,
		[5] = 60.5000114,
	},
	nebula = {
		[1] = 51.0467834,
		[2] = 12.2404509,
		[3] = 27.6913109,
		[4] = 27.660862,
	},
	shipaa = {
		[1] = 12.5280018,
		[2] = 12.960001,
	},
	shipassault = {
		[1] = 34.8000031,
		[2] = 14.4000006,
	},
	shipheavyarty = {
		[1] = 28.9825878,
		[2] = 22.6713886,
		[3] = 13.5201349,
	},
	shipriot = {
		[1] = 10.125,
		[2] = 10.125,
	},
	striderbantha = {
		[1] = 78.3360062,
		[2] = 55.0400009,
		[3] = 78.3360062,
	},
	striderdetriment = {
		[1] = 78.3443527,
		[2] = 78.3443604,
		[3] = 137.301987,
		[4] = 119.350998,
		[5] = 115.669991,
		[6] = 9.58999634,
	},
	striderscorpion = {
		[1] = 4,
		[2] = 55.9872627,
		[3] = 55.9872627,
		[4] = 26.7000008,
		[5] = 26.7000008,
	},
	tankheavyassault = {
		[1] = 23.6632004,
		[2] = 35.5487022,
	},
	turretheavy = {
		[1] = 70.8000031,
		[2] = 14.4000006,
	},
}
return WG.aim_from_poses

--[[ by Helwor, license GNU GPL, v2 or later
-- table generated by the code below, spawning each and every unit, noting the aim from piece position, then remove the unit, and so on
local AIM_FROM = VFS.Include(LUAUI_DIRNAME .. '/Widgets/Include/aim_from_pieces_2.lua')
local ret = VFS.FileExists(LUAUI_DIRNAME .. '/Widgets/Include/aim_from_poses.lua') and VFS.Include(LUAUI_DIRNAME .. '/Widgets/Include/aim_from_poses.lua') or {}
for k,v in pairs(ret) do
    ret[k] = nil
end
local function Start()
    local defID = 0

    local id = 0
    local step = 0
    local def = false
    local t = {}
    local scriptName
    return function()
        step = step + 1
        if step == 3 then step = 1 end
        if step == 1 then
            defID = defID + 1
            while UnitDefs[defID] and (ret[UnitDefs[defID].name] or not UnitDefs[defID].weapons[1]) do
                --Echo('skip', UnitDefs[defID].name)
                defID = defID + 1
            end
            t[1] = defID
            def = UnitDefs[defID]
            if not def then
                Echo('Done, saving ...')
                table.save(ret, LUAUI_DIRNAME .. '/Widgets/Include/aim_from_poses.lua')
                widgetHandler:RemoveWidget(widget)
                return
            end
            scriptName = def.scriptName:match('/(.*)%....')
            Spring.SendCommands('give ' .. def.name)
        elseif step == 2 then
            id = Spring.GetTeamUnitsByDefs(myTeamID, t)[1]
            if not id then
                if def.name ~= 'asteroid' then
                    Echo('too fast')
                    -- Spring.SendCommands('give ' .. def.name)
                    step = 1
                end
                return
            end
            Spring.SelectUnit(id)
            -- local pieceMap = Spring.GetUnitPieceMap(id or 0)
            local pieceMap = Spring.GetModelPieceMap(def.modelname)
            local aimPiece= AIM_FROM[scriptName]
            local weapNum = 1
            -- if type(aimPiece) == 'function' then
            --     aimPiece = aimPiece(weapNum, id, weapNum)
            -- end
            if type(aimPiece) == 'table' then
                local t = {}
                ret[def.name] = t
                for weapNum, piece in pairs(aimPiece) do
                    local pieceIndex = pieceMap[piece]
                    local offY
                    if pieceIndex then
                        local wx, wy, wz = Spring.GetUnitPiecePosition(id, pieceIndex)
                        offY = wy
                    else
                        offY = 'bad aim piece ' .. tostring(piece) -- never happened
                        Echo('Error no piece index for defId', defID, scriptName,'weapNum', weapNum, 'piece', piece, 'aimFrom', AIM_FROM[def.name])
                    end
                    t[weapNum] = offY
                end
            else
                local offY

            -- Echo("aimPiece is ", aimPiece)
                if aimPiece then
                    local pieceIndex = pieceMap[aimPiece]
                    if pieceIndex then
                        local wx, wy, wz = Spring.GetUnitPiecePosition(id, pieceIndex)
                        offY = wy
                    else
                        offY = 'bad aim piece ' .. tostring(aimPiece) -- never happened
                        Echo('Error no piece index for defId', defID, scriptName,'weapNum', weapNum, 'piece', aimPiece, 'aimFrom', AIM_FROM[def.name])

                    end
                else
                    -- Echo('no aimFrom piece for defID', defID, scriptName,'weapNum', weapNum, 'aimFrom', AIM_FROM[def.name])
                end
                ret[def.name] = offY
            end
            
            table.save(ret, LUAUI_DIRNAME .. '/Widgets/Include/aim_from_poses.lua')
            Spring.SendCommands('remove')
        end
    end
end

local Run = Start()
function widget:GameFrame(f)
    if f%15 == 0 then
        Run()
    end
end
--]]
